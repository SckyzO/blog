---
import type { Page, GetStaticPathsOptions } from 'astro';
import { getCollection, type CollectionEntry } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Card from '../components/Card.astro';
import { getReadingTime } from '../utils/readingTime';

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allPosts = await getCollection('blog', ({ data }) => {
    return data.isDraft !== true;
  });
  
  const sortedPosts = allPosts.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

  return paginate(sortedPosts, { pageSize: 6 });
}

interface Props {
  page: Page<CollectionEntry<'blog'>>;
}

const { page } = Astro.props;
---

<BaseLayout title="Accueil | Tomzone Blog">
    <Header slot="header" />
    
    <section class="py-12">
        <h1 class="text-5xl font-bold text-center mb-12">Derniers Articles</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            {page.data.map((post) => (
                <Card 
                    title={post.data.title}
                    description={post.data.description}
                    pubDate={post.data.pubDate}
                    url={`/blog/${post.id}/`}
                    image={post.data.heroImage}
                    tags={post.data.tags}
                    readingTime={getReadingTime(post.body ?? "")}
                />
            ))}
        </div>

        {/* Navigation de pagination DaisyUI */}
        <div class="flex justify-center mt-12">
            <div class="join">
                {page.url.prev ? (
                    <a href={page.url.prev} class="join-item btn btn-outline">Précédent</a>
                ) : (
                    <button class="join-item btn btn-outline btn-disabled">Précédent</button>
                )}
                
                <button class="join-item btn btn-outline no-animation">
                    Page {page.currentPage} sur {page.lastPage}
                </button>

                {page.url.next ? (
                    <a href={page.url.next} class="join-item btn btn-outline">Suivant</a>
                ) : (
                    <button class="join-item btn btn-outline btn-disabled">Suivant</button>
                )}
            </div>
        </div>
    </section>

    <Footer slot="footer" />
</BaseLayout>
